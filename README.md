# skill-trader

Claude Code plugin for automated MetaTrader 5 Expert Advisor build & backtest on macOS.

**Compile** (.mq5 -> .ex5) -> **Backtest** (real tick data) -> **Monitor** -> **Collect** (CSV with trade-by-trade analysis)

## Installation

### Method 1: Plugin Marketplace (Recommended)

```
/plugin marketplace add anhnguyen123312/skill-trader
/plugin install skill-trader@skill-trader
```

### Method 2: One-Liner (Skill Only)

```bash
# Install to current project
curl -fsSL https://raw.githubusercontent.com/anhnguyen123312/skill-trader/main/install.sh | bash

# Install globally (all projects)
curl -fsSL https://raw.githubusercontent.com/anhnguyen123312/skill-trader/main/install.sh | bash -s -- --global

# Install full pipeline (skill + scripts + config + example EA)
curl -fsSL https://raw.githubusercontent.com/anhnguyen123312/skill-trader/main/install.sh | bash -s -- --full
```

### Method 3: Manual

```bash
# Skill only
mkdir -p .claude/skills/mt5-backtest
curl -fsSL https://raw.githubusercontent.com/anhnguyen123312/skill-trader/main/skills/mt5-backtest/SKILL.md \
  -o .claude/skills/mt5-backtest/SKILL.md

# Or clone everything
git clone https://github.com/anhnguyen123312/skill-trader.git
```

## Prerequisites

| Requirement | Install | Notes |
|-------------|---------|-------|
| MetaTrader 5 | `brew install --cask metatrader5` or [download](https://www.metatrader5.com/en/download) | Includes Wine, MetaEditor, Terminal |
| macOS | Required | Wine bundled with MT5 app |
| iconv | Built-in | For UTF-16LE log parsing |

All dependencies (Wine64, MetaEditor64, Terminal64) come bundled with the MT5 app. No separate installation needed.

## Quick Start

```bash
# 1. Login (interactive - prompts for missing fields)
./scripts/login.sh

# 2. Place your EA source
cp MyEA.mq5 code/experts/

# 3. Run backtest (interactive - prompts all params)
./scripts/backtest.sh

# 4. Or run full pipeline with CLI args
./scripts/run.sh MyEA XAUUSD M15 2024.01.01 2024.12.31 --no-visual

# 5. Results appear in results/
```

## Skills

| Skill | Trigger | Description |
|-------|---------|-------------|
| `mt5-backtest` | "backtest EA", "compile EA", "test EA" | Full build & backtest pipeline |

## Repository Structure

```
skill-trader/
  .claude-plugin/
    plugin.json              # Plugin manifest
    marketplace.json         # Marketplace config
  skills/
    mt5-backtest/
      SKILL.md               # Skill documentation
  scripts/
    run.sh                   # E2E orchestrator
    compile.sh               # MQ5 -> EX5 via Wine MetaEditor
    backtest.sh              # Launch MT5 backtest (interactive or CLI)
    monitor.sh               # Poll for completion
    collect.sh               # Parse CSV results
    login.sh                 # Login & credential manager (interactive)
  config/
    backtest.template.ini    # [Tester] config with __PLACEHOLDERS__
    credentials.env          # Auto-generated by login.sh (gitignored)
    mt5-credentials/         # Backup of accounts.dat, servers.dat, common.ini (gitignored)
  code/
    experts/
      SimpleMA_EA.mq5        # Example EA with OnTester() export
  install.sh                 # One-liner installer
```

## Usage

### Interactive Mode (Recommended)

```bash
# Login - prompts for Login, Server, Password step by step
./scripts/login.sh
# Login [128364028]:          <- Enter = use default
# Server [Exness-MT5Real7]:   <- Enter = use default
# Password:                   <- hidden input, required

# Backtest - prompts for EA, Symbol, Period, Date, Visual
./scripts/backtest.sh
# Available EAs:
#   1. SimpleMA_EA
# EA [1]:                     <- pick by number or name
# Symbol [XAUUSD]:
# Period [M15]:
# From [2024.01.01]:
# To [2024.12.31]:
# Visual? (y/n) [n]:
```

### CLI Mode

```bash
# E2E pipeline
./scripts/run.sh <EA_NAME> [SYMBOL] [PERIOD] [FROM] [TO] [--no-visual]

# Examples
./scripts/run.sh SimpleMA_EA XAUUSD M15 2024.01.01 2024.12.31 --no-visual
./scripts/run.sh MyEA EURUSD H1 2023.01.01 2024.12.31 --no-visual

# Individual steps
./scripts/compile.sh SimpleMA_EA
./scripts/backtest.sh SimpleMA_EA XAUUSD M15 2024.01.01 2024.12.31 --no-visual
./scripts/monitor.sh 30
./scripts/collect.sh SimpleMA_EA XAUUSD M15

# Login management
./scripts/login.sh                          # Interactive login
./scripts/login.sh <LOGIN> <PASS> <SERVER>  # Direct login
./scripts/login.sh --status                 # Check status
./scripts/login.sh --backup                 # Backup credentials
./scripts/login.sh --restore                # Restore from backup
```

## Credential Management

### How It Works

1. `login.sh` authenticates with MT5 via Wine, caches credentials in `accounts.dat`
2. After successful login, saves password to `config/credentials.env` (chmod 600)
3. `backtest.sh` reads `credentials.env` and includes `Password=` in `[Common]` section
4. MT5 Tester uses the password to authenticate without showing a login popup
5. `login.sh --backup` saves `accounts.dat`, `servers.dat`, `common.ini` to `config/mt5-credentials/`

### Credential Priority (highest first)

1. Environment variables: `MT5_LOGIN`, `MT5_PASSWORD`, `MT5_SERVER`
2. `config/credentials.env` (auto-generated by `login.sh`)
3. Cached `common.ini` (for login/server defaults only)
4. Hardcoded defaults: `128364028` / `Exness-MT5Real7`

### Security

- `config/credentials.env` is in `.gitignore` (never committed)
- `config/mt5-credentials/` is in `.gitignore` (never committed)
- `credentials.env` is chmod 600 (owner-only read/write)
- Login config (contains password) is deleted after use

## Config

Template: `config/backtest.template.ini` (only `[Tester]` section - `[Common]` is generated dynamically by `backtest.sh`)

| Parameter | Default | Description |
|-----------|---------|-------------|
| Deposit | 1000 | Starting capital (USD) |
| Leverage | 1:1000 | Broker leverage |
| Model | 4 | 0=Every tick, 1=1min OHLC, 2=Open prices, 4=Real ticks |
| Delay | 100 | Slippage emulation (ms) |

See `skills/mt5-backtest/SKILL.md` for full documentation, troubleshooting, and known issues.

## License

MIT
